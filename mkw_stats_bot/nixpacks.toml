[build]
providers = ["python"]

[build.env]
PYTHONUNBUFFERED = "1"
PYTHONDONTWRITEBYTECODE = "1"

[phases.setup]
aptPkgs = [
    "tesseract-ocr", 
    "tesseract-ocr-eng", 
    "libglib2.0-0", 
    "libsm6", 
    "libxext6", 
    "libxrender1", 
    "libgomp1",
    "libglib2.0-0",
    "libgtk-3-0",
    "libavcodec-dev",
    "libavformat-dev",
    "libswscale-dev",
    "libv4l-dev",
    "libxvidcore-dev",
    "libx264-dev",
    "libjpeg-dev",
    "libpng-dev",
    "libtiff-dev",
    "libatlas-base-dev",
    "gfortran",
    "libhdf5-dev"
]

[phases.install]
# Force install headless OpenCV first to prevent GUI library conflicts
cmds = [
    "pip install opencv-python-headless>=4.5.0",
    "pip uninstall -y opencv-python || true",
    "pip install --force-reinstall opencv-python-headless>=4.5.0"
]

[start]
cmd = "python main.py"